
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Sojiro&#8217;s Blog</title>
  <meta name="author" content="Sojiro">

  
  <meta name="description" content="MySQLでカラムにNOT NULLを指定した際、そのカラムに対するインサート操作による挙動が特殊なのでまとめる。 単列インサートと複数列インサートで挙動が変わる NOT NULLを指定したカラムを含むテーブルへのインサートでは、一度に1行のみ挿入する単列インサートと、 &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://sojiro14.github.io/page7">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Sojiro's Blog" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=Fjalla+One" rel="stylesheet" type="text/css">
<!--- MathJax Configuration -->
<script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
  
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-50182043-1', 'auto');
    ga('send', 'pageview');

  </script>



</head>

<body   class="collapse-sidebar sidebar-footer" >
  <header role="banner"><hgroup>
  <h1><a href="/">Sojiro&#8217;s Blog</a></h1>
  
    <h2>This is nothing much.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscribe" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS" target="_blank"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="25" height="25" viewbox="0 0 100 100"><path class="social" d="M 13.310204,73.332654 C 5.967347,73.332654 0,79.322448 0,86.621428 c 0,7.338776 5.967347,13.262246 13.310204,13.262246 7.370408,0 13.328572,-5.92245 13.328572,-13.262246 0,-7.29898 -5.958164,-13.288774 -13.328572,-13.288774 z M 0.01530612,33.978572 V 53.143878 C 12.493878,53.143878 24.229592,58.02347 33.068368,66.865306 41.894898,75.685714 46.767346,87.47449 46.767346,100 h 19.25 C 66.017346,63.592858 36.4,33.979592 0.01530612,33.978572 l 0,0 z M 0.03877552,0 V 19.17449 C 44.54796,19.17551 80.77551,55.437756 80.77551,100 H 100 C 100,44.87653 55.15102,0 0.03877552,0 z"></path></svg></a></li>
  
</ul>
  
  
  
  
  
<ul class="subscribe">
  <li><a href="https://github.com/sojiro14" rel="subscribe-github" title="@sojiro14 on GitHub" target="_blank"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="25" height="25" viewbox="0 0 100 100"><path class="social" d="M 50,0 C 22.385714,0 0,22.385714 0,50 0,77.614286 22.385714,100 50,100 77.614286,100 100,77.614286 100,50 100,22.385714 77.614286,0 50,0 z m 29.692858,79.692858 c -3.859184,3.859182 -8.351022,6.887754 -13.35,9.00306 -1.27041,0.536736 -2.560204,1.009184 -3.867348,1.415306 v -7.493878 c 0,-3.938774 -1.35102,-6.835714 -4.053062,-8.690816 1.692858,-0.163264 3.24694,-0.390816 4.663266,-0.683672 1.416326,-0.292858 2.913266,-0.716328 4.491838,-1.27041 1.57857,-0.55408 2.994896,-1.213264 4.247958,-1.97755 1.253062,-0.765306 2.458164,-1.758164 3.613266,-2.978572 1.155102,-1.220408 2.12449,-2.604082 2.905102,-4.15 0.780612,-1.545918 1.4,-3.40204 1.855102,-5.566326 0.455102,-2.164286 0.683674,-4.54898 0.683674,-7.153062 0,-5.045918 -1.643878,-9.341836 -4.931634,-12.890816 C 77.44796,33.35 77.285714,29.10204 75.463266,24.512244 l -1.22143,-0.145918 c -0.845918,-0.09796 -2.368366,0.260204 -4.565306,1.07449 -2.196938,0.814286 -4.663264,2.14796 -7.396938,4.004082 -3.87449,-1.07449 -7.893878,-1.611224 -12.061224,-1.611224 -4.19898,0 -8.203062,0.536734 -12.012246,1.611224 -1.72449,-1.17245 -3.361224,-2.139796 -4.907142,-2.905102 C 31.753062,25.77449 30.516326,25.254082 29.587756,24.97653 28.660204,24.7 27.79796,24.528572 27,24.463266 c -0.79796,-0.0653 -1.310204,-0.08062 -1.537756,-0.04898 -0.22755,0.03164 -0.390816,0.0653 -0.487754,0.09796 -1.82347,4.62245 -1.985714,8.87143 -0.487756,12.743878 -3.287754,3.54796 -4.931632,7.844898 -4.931632,12.890816 0,2.604082 0.227552,4.988776 0.683674,7.153062 0.456122,2.164286 1.07449,4.020408 1.855102,5.566326 0.780612,1.545918 1.75,2.929592 2.905102,4.15 1.155102,1.220408 2.360204,2.213266 3.613264,2.978572 1.253062,0.766326 2.669388,1.42449 4.24796,1.97755 1.578572,0.554082 3.07551,0.976532 4.491836,1.27041 1.416328,0.292856 2.970408,0.521428 4.663266,0.683672 -2.669388,1.82347 -4.004082,4.720408 -4.004082,8.690816 v 7.639796 C 36.536734,89.818368 35.083674,89.3 33.656122,88.695918 c -4.99898,-2.115306 -9.490816,-5.143878 -13.35,-9.00306 -3.859184,-3.859184 -6.887754,-8.351022 -9.00306,-13.35 C 9.1163263,61.171428 8.0071428,55.67347 8.0071428,50 c 0,-5.67347 1.1091835,-11.171428 3.2969392,-16.342858 2.115306,-4.998978 5.143878,-9.490816 9.00306,-13.35 3.859184,-3.859182 8.351022,-6.887754 13.35,-9.00306 C 38.828572,9.1163266 44.32653,8.0071428 50,8.0071428 c 5.67347,0 11.171428,1.1091838 16.342858,3.2969392 5,2.115306 9.490816,5.143878 13.35,9.00306 3.859182,3.859184 6.887754,8.351022 9.00306,13.35 2.186736,5.17245 3.295918,10.67041 3.295918,16.342858 0,5.672448 -1.109182,11.171428 -3.296938,16.342858 -2.115306,4.998978 -5.143878,9.490816 -9.00204,13.35 l 0,0 z"></path></svg></a></li>
</ul>
  
  
  
<ul class="subscribe">
  <li><a href="https://twitter.com/sojiro14" rel="subscribe-twitter" title="@sojiro14 on Twitter" target="_blank"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="25" height="25" viewBox="0 0 512 512"><path class="social" d="M0.001,334.932c33.327,30.816,118.891,59.981,188.517-8.271c-12.52,1.955-22.972-0.416-30.913-8.269
  c-7.531-7.465-7.945-15.182-3.914-22.202c3.275-5.725,10.184-9.741,16.977-13.934c-12.323,2.285-22.829,1.095-32.218-3.706
  c-12.604-6.444-24.863-13.228-28.3-27.207c7.71-8.112,16.28-15.359,34.831-12.627c-17.45-5.83-33.087-13.429-44.41-24.815
  c-11.028-11.091-12.163-18.302-13.932-26.996c9.632-3.567,19.688-5.421,30.478-4.353c-24.397-12.476-34.757-29.63-40.487-48.325
  c-1.731-5.652-2.044-11.03-1.31-16.545c98.826,37.305,145.11,64.109,170.662,89.251c11.496-30.589,38.3-99.868,78.371-123.646
  c0.191,3.77-1.309,7.837-4.357,12.189c11.863-6.609,21.125-17.188,37.445-16.98c-1.879,7.723-7.279,13.904-17.85,17.854
  c10.662-4.084,21.463-7.545,32.65-9.578c10.375-1.881,10.229,6.304,4.355,10.444c-11.916,8.412-24.578,9.456-37.006,13.498
  c38.105,0.949,69.266,18.994,93.604,58.343c8.088,13.074,13.52,26.149,14.807,40.487c16.254,4.563,32.426,5.494,48.76,2.61
  c4.475-0.796,8.645-1.63,12.627-3.482c-6.354,9.529-13.686,17.356-23.947,20.899c-9.811,3.387-19.637,6.688-30.473,6.968
  c17.641,6.675,37.082,7.045,57.033,5.659c-24.402,23.486-43.08,22.922-61.824,22.642c-8.221,34.703-25.025,69.315-60.52,101.005
  c-46.559,41.569-96.678,61.397-148.457,65.742c-48.552,4.07-95.488,3.512-146.726-20.464
  C56.486,393.349,24.648,368.884,0.001,334.932L0.001,334.932z"/></svg></a></li>
</ul>
  
  
  
  
  
  
    
      <form action="https://www.google.com/search" method="get">
        <fieldset role="search">
          <input type="hidden" name="sitesearch" value="sojiro14.github.io" />
    
          <input class="search" type="text" name="q" results="0" placeholder="Search"/>
        </fieldset>
      </form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/blog/categories">Categories</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/10/20/behavior-of-inserting-rows-at-not-null-column-on-mysql/">MySQLにおけるNOT NULLカラムへのインサート時の挙動</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-10-20T13:44:28+09:00'><span class='date'><span class='date-month'>Oct</span> <span class='date-day'>20</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>1:44 pm</span></time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><p>MySQLでカラムにNOT NULLを指定した際、そのカラムに対するインサート操作による挙動が特殊なのでまとめる。</p>

<h2>単列インサートと複数列インサートで挙動が変わる</h2>

<p> <code>NOT NULL</code>を指定したカラムを含むテーブルへのインサートでは、一度に1行のみ挿入する単列インサートと、一度に複数行を挿入する複数列インサート（バルクインサート）で挙動が変わる。</p>

<p><a href="http://dev.mysql.com/doc/refman/5.6/en/insert.html">MySQLマニュアル</a>からの抜粋</p>

<blockquote><p>Inserting NULL into a column that has been declared NOT NULL. For multiple-row INSERT statements or INSERT INTO &hellip; SELECT statements, the column is set to the implicit default value for the column data type. This is 0 for numeric types, the empty string (&lsquo;&rsquo;) for string types, and the “zero” value for date and time types. INSERT INTO &hellip; SELECT statements are handled the same way as multiple-row inserts because the server does not examine the result set from the SELECT to see whether it returns a single row. (For a single-row INSERT, no warning occurs when NULL is inserted into a NOT NULL column. Instead, the statement fails with an error.)</p></blockquote>

<p>単列インサートの場合は<code>NOT NULL</code>が指定されたカラムに<code>NULL</code>値が挿入されるとそのクエリはエラーとなって失敗するが、複数列インサートの場合は警告(warning)を発するものの、クエリは正常に受け付けられる。</p>

<p>その際、<code>NULL</code>値が指定された各カラムにはそれぞれのカラムのデータ型の暗黙的なデフォルト値が挿入される。（数値型なら<code>0</code>、文字列型なら空文字<code>''</code>、etc&hellip;）</p>

<h2>検証</h2>

<ul>
<li>MySQLのバージョンは5.1.69

<ul>
<li>ただしマニュアルの該当箇所はバージョン5.7まで変更がないため、どのバージョンでも同じ挙動と思われる</li>
</ul>
</li>
<li>テーブル定義は以下</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='mysql'><span class='line'><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="ss">`not_null_test`</span> <span class="p">(</span>
</span><span class='line'>  <span class="ss">`id`</span> <span class="kt">int</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="k">unsigned</span> <span class="k">NOT</span> <span class="no">NULL</span><span class="p">,</span>
</span><span class='line'>  <span class="ss">`test_score`</span> <span class="kt">int</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="k">unsigned</span> <span class="k">NOT</span> <span class="no">NULL</span><span class="p">,</span>
</span><span class='line'>  <span class="ss">`created_at`</span> <span class="kt">timestamp</span> <span class="k">NOT</span> <span class="no">NULL</span> <span class="k">DEFAULT</span> <span class="s1">&#39;0000-00-00 00:00:00&#39;</span><span class="p">,</span>
</span><span class='line'>  <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="ss">`id`</span><span class="p">)</span>
</span><span class='line'><span class="p">)</span> <span class="kp">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span> <span class="k">DEFAULT</span> <span class="kp">CHARSET</span><span class="o">=</span><span class="n">utf8</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<h3>単列インサート</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='mysql'><span class='line'><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">insert</span> <span class="k">into</span>
</span><span class='line'><span class="nf">not_null_test</span>
</span><span class='line'><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">test_score</span><span class="p">,</span> <span class="n">created_at</span><span class="p">)</span>
</span><span class='line'><span class="k">values</span>
</span><span class='line'><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="no">NULL</span><span class="p">,</span> <span class="no">NULL</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="n">ERROR</span> <span class="mi">1048</span> <span class="p">(</span><span class="mi">23000</span><span class="p">):</span> <span class="k">Column</span> <span class="s1">&#39;test_score&#39;</span> <span class="n">cannot</span> <span class="n">be</span> <span class="no">null</span>
</span></code></pre></td></tr></table></div></figure>


<h3>複数列インサート</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='mysql'><span class='line'><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">insert</span> <span class="k">into</span>
</span><span class='line'><span class="nf">not_null_test</span>
</span><span class='line'><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">test_score</span><span class="p">,</span> <span class="n">created_at</span><span class="p">)</span>
</span><span class='line'><span class="k">values</span>
</span><span class='line'><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="no">NULL</span><span class="p">,</span> <span class="no">NULL</span><span class="p">),</span>
</span><span class='line'><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="no">NULL</span><span class="p">,</span> <span class="no">NULL</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="n">Query</span> <span class="n">OK</span><span class="p">,</span> <span class="mi">2</span> <span class="n">rows</span> <span class="n">affected</span><span class="p">,</span> <span class="mi">2</span> <span class="nf">warnings</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>
</span><span class='line'><span class="n">Records</span><span class="p">:</span> <span class="mi">2</span>  <span class="n">Duplicates</span><span class="p">:</span> <span class="mi">0</span>  <span class="n">Warnings</span><span class="p">:</span> <span class="mi">2</span>
</span><span class='line'>
</span><span class='line'><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">not_null_test</span><span class="p">;</span>
</span><span class='line'><span class="o">+----+------------+---------------------+</span>
</span><span class='line'><span class="o">|</span> <span class="n">id</span> <span class="o">|</span> <span class="n">test_score</span> <span class="o">|</span> <span class="n">created_at</span>          <span class="o">|</span>
</span><span class='line'><span class="o">+----+------------+---------------------+</span>
</span><span class='line'><span class="o">|</span>  <span class="mi">1</span> <span class="o">|</span>          <span class="mi">0</span> <span class="o">|</span> <span class="mi">2014</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">18</span> <span class="mi">13</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mi">10</span> <span class="o">|</span>
</span><span class='line'><span class="o">|</span>  <span class="mi">2</span> <span class="o">|</span>          <span class="mi">0</span> <span class="o">|</span> <span class="mi">2014</span><span class="o">-</span><span class="mi">10</span><span class="o">-</span><span class="mi">18</span> <span class="mi">13</span><span class="p">:</span><span class="mi">35</span><span class="p">:</span><span class="mi">10</span> <span class="o">|</span>
</span><span class='line'><span class="o">+----+------------+---------------------+</span>
</span><span class='line'><span class="mi">2</span> <span class="n">rows</span> <span class="k">in</span> <span class="kt">set</span> <span class="p">(</span><span class="mi">0</span><span class="p">.</span><span class="mi">00</span> <span class="n">sec</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>※ timestampにテーブル定義で設定したデフォルト値<code>'0000-00-00 00:00:00'</code>ではなく、型のデフォルト値である現在時刻が入っている点に注意</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/09/14/what-is-rest/">RESTとはなにか</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-09-14T13:57:07+09:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>14</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>1:57 pm</span></time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><p>APIを実装することになり、今更ながらWebのアーキテクチャスタイルであるRESTとはなにか理解するためにまとめてみた。</p>

<h2>Webのアーキテクチャスタイル</h2>

<p>Webのアーキテクチャスタイルはクライアント/サーバーというスタイルを中心に、いくつかの制限（アーキテクチャ）を複合的に組み合わせたREST(Representational State Transfer)を理想としている</p>

<h2>RESTはどのようなスタイルなのか</h2>

<p>RESTは以下のスタイルを複合的に組み合わせたアーキテクチャである</p>

<ul>
<li>クライアント/サーバー</li>
<li>ステートレスサーバー</li>
<li>キャッシュ</li>
<li>統一インターフェース</li>
<li>階層化システム</li>
<li>コードオンデマンド</li>
</ul>


<h3>クライアント/サーバー</h3>

<p>WebではHTTPでクライアントとサーバーが通信する、クライアント/サーバーアーキテクチャを採用している。クライアントはサーバーにリクエストを送り、サーバーはそれに対してレスポンスを返す。</p>

<p>ユーザーインターフェースはクライアントに任せればよく、サーバーは処理に専念できるので様々なデバイス（PC・携帯電話・ゲーム機）に対応でき、サーバーの冗長化も容易である。</p>

<h3>ステートレスサーバー</h3>

<p>ステートフル/ステートレスという考え方があるが、サーバーがステートレスなやり取りを前提としていること。</p>

<p>ステートフル/ステートレスに関しては以下のエントリを参照</p>

<ul>
<li><a href="http://sojiro14.github.io/blog/2014/09/13/stateful-and-stateless/">ステートフル/ステートレスとはどういうことか</a></li>
</ul>


<h3>キャッシュ</h3>

<p>一度取得したリソースをクライアント側である程度の期間保持して使い回すこと。</p>

<ul>
<li>メリット

<ul>
<li>同じリソースを取得するためにその都度クライアント/サーバー間で通信する必要がなくなる</li>
<li>これによりネットワークの帯域節約や処理の高速化を実現できる</li>
</ul>
</li>
<li>デメリット

<ul>
<li>適切に制御しないと意図せず古いリソースを参照してしまうことがある</li>
<li>特に大規模なシステムではどこで何がキャッシュされているか正確に把握するのは容易ではない</li>
</ul>
</li>
</ul>


<h3>統一インターフェース</h3>

<p>リソースに対する操作を統一したインターフェースで行う。</p>

<p>HTTP/1.1ではリソースに対するメソッドが8つのみ定義されている。このようにインターフェースを限定することで様々なコンポーネントが生まれても統一された仕様としてリソースへの操作が行われ、それぞれの独立性が保たれることで多様性を受け入れることができる。</p>

<h3>階層化システム</h3>

<p>統一インターフェースを採用することにより、クライアント/サーバー間にプロキシなどのコンポーネントを設置してもクライアントはそのままリクエストを送ることができる。</p>

<p>これにより大規模システムではロードバランサーを導入したり、HTTPインターフェースを持たないコンポーネントに対してHTTPインターフェースをもつサーバーを返して処理をするなどの階層化が可能となる。</p>

<p>このようなアーキテクチャを階層化システムと呼ぶ。</p>

<h3>コードオンデマンド</h3>

<p>プログラムをサーバーからクライアントが受け取り、それをクライアント上で実行するアーキテクチャスタイル。JavaScriptやFlashがこれに該当する。</p>

<ul>
<li>メリット

<ul>
<li>サーバーと都度通信することなくクライアント側のみで処理できることが増える</li>
<li>これによりユーザーのアクションに対する処理の速度が向上する</li>
</ul>
</li>
<li>デメリット

<ul>
<li>クライアント/サーバー間でやり取りされるリソースが不明確になる</li>
<li>クライアント側の裁量が増える分、サーバーとやり取りされるリソースの内容が明確ではなくなる</li>
</ul>
</li>
</ul>


<h2>RESTful</h2>

<p>RESTの思想に忠実に設計されていることをRESTfulである、と言う。</p>

<p>RESTは上記の通り分散ネットワークを効率的に、可用性・冗長性高く利用するための理論であり、Webが理想とするアーキテクチャスタイルである。</p>

<p>この思想に則った設計がされることで多様なシステムの中にも仕様の統一感が生まれ、Webの世界が広がったと言える。</p>

<h2>参考</h2>

<p><a href="http://www.amazon.co.jp/gp/product/4774142042/ref=as_li_tf_tl?ie=UTF8&amp;camp=247&amp;creative=1211&amp;creativeASIN=4774142042&amp;linkCode=as2&amp;tag=sojiro14-22">Webを支える技術 -HTTP、URI、HTML、そしてREST (WEB+DB PRESS plus)</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/09/13/stateful-and-stateless/">ステートフル ステートレスとはどういうことか</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-09-13T18:00:03+09:00'><span class='date'><span class='date-month'>Sep</span> <span class='date-day'>13</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>6:00 pm</span></time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><p>コンポーネント間のやり取りにはステートフル/ステートレスという考え方がある。FTPではステートフルなやり取りが、HTTPではステートレスなやり取りが採用されいるが、それぞれの特徴についてまとめてみる。</p>

<h2>セッション状態（アプリケーション状態）</h2>

<p>システムにログインしてからログアウトするまでの一連の操作をセッションと呼ぶ。その一連の操作の中のそれぞれの状態をセッション状態と呼ぶ。</p>

<h2>ステートフル</h2>

<p>ステートフルなやり取りではサーバーはクライアントのセッション状態を保持している。</p>

<ul>
<li>メリット

<ul>
<li>やり取りが完結に済む</li>
<li>それによりネットワークの帯域を節約できる</li>
</ul>
</li>
<li>デメリット

<ul>
<li>クライアントの状態を都度把握しておかなければいけないのでクライアントが増えると負荷も増える</li>
<li>サーバーを複数台設置する場合にはそれぞれのサーバー間でクライアントの状態を同期しなければいけない</li>
<li>これらの理由によりスケールアウトには向かない</li>
</ul>
</li>
</ul>


<h2>ステートレス</h2>

<p>ステートレスなやり取りではサーバーはクライアントのセッション情報を保持しない。</p>

<ul>
<li>メリット

<ul>
<li>クライアントのリクエストは状態に依存せず、常にリソースに対する操作に必要十分な情報となる</li>
<li>よってサーバーが増えてもそのままのリクエストでいつも同じリソースに対する操作ができる</li>
<li>このためスケールアウトに向いている</li>
<li>また処理がクライアントの状態に依らないので処理がシンプルになる</li>
</ul>
</li>
<li>デメリット

<ul>
<li>やり取りが冗長になりがちである</li>
<li>またリソースへの操作が必要になる度にそのやり取りを繰り返す必要がある</li>
<li>これによりネットワークの帯域を消費し、処理も遅くなる</li>
<li>サーバーが状態を保持していないのでエラーが起きたときのハンドリングが複雑になりがちである</li>
</ul>
</li>
</ul>


<h2>参考</h2>

<p><a href="http://www.amazon.co.jp/gp/product/4774142042/ref=as_li_tf_tl?ie=UTF8&amp;camp=247&amp;creative=1211&amp;creativeASIN=4774142042&amp;linkCode=as2&amp;tag=sojiro14-22">Webを支える技術 -HTTP、URI、HTML、そしてREST (WEB+DB PRESS plus)</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/08/31/presentation-by-reveal-dot-js/">reveal.jsを使ったプレゼンテーションの作成</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-08-31T19:17:21+09:00'><span class='date'><span class='date-month'>Aug</span> <span class='date-day'>31</span><span class='date-suffix'>st</span>, <span class='date-year'>2014</span></span> <span class='time'>7:17 pm</span></time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="http://yapcasia.org/2014/">YAPC::Asia 2014</a>のLTに登壇させていただいた。その際、サクッとオシャレなプレゼンテーションを作ることができるということでreveal.jsを使って作ったのでメモ。</p>

<ul>
<li><a href="http://sojiro14.github.io/presentation/2014/08/30/YAPC-Asia-LT/">実際のプレゼンテーション</a>（一部の画像を削除したもの）</li>
</ul>


<h2>reveal.jsとは</h2>

<p>htmlやmarkdown形式で簡単にリッチなプレゼンテーションを書くことができるjsやcssを中心としたライブラリ</p>

<ul>
<li><a href="https://github.com/hakimel/reveal.js/">reveal.jsの実体</a></li>
<li><a href="http://lab.hakim.se/reveal-js/#/">本家Demo</a></li>
</ul>


<h2>reveal.jsの入手</h2>

<p><a href="https://github.com/hakimel/reveal.js">GitHubのreveal.jsリポジトリ</a>からzipをダウンロードする。右下の<code>Download ZIP</code>ボタンを押すだけで完了。</p>

<h2>プレゼンテーションの作成</h2>

<p>基本的に<code>index.html</code>を編集していく。特に以下の部分を編集していけば良い。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;slides&quot;</span><span class="nt">&gt;</span>
</span><span class='line'><span class="c">&lt;!---...</span>
</span><span class='line'><span class="c">ここを編集</span>
</span><span class='line'><span class="c">...--&gt;</span>
</span><span class='line'><span class="nt">&lt;/div&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>デフォルトでは<a href="http://lab.hakim.se/reveal-js/#/">本家Demo</a>の仕様となっている。</p>

<h2>ページの追加</h2>

<p> <code>&lt;section&gt;&lt;/section&gt;</code>タグを追加することで新しいページを追加することができる。新しいページは右側に追加されていく。</p>

<p>さらに<code>&lt;section&gt;&lt;/section&gt;</code>タグの中に<code>&lt;section&gt;&lt;/section&gt;</code>タグをネストすることで、縦方向にスライドを追加することができる。</p>

<h2>スライドの動きの設定</h2>

<p> <code>&lt;section&gt;</code>タグに<code>data-transition</code>や<code>data-background-transition</code>を指定することでスライドの動きを設定できる。</p>

<p>デフォルトではスライドが回転するように動いていくが、例えば以下のように設定することで横方向にスライドが流れるようになる。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;section</span> <span class="na">data-transition=</span><span class="s">&quot;linear&quot;</span> <span class="na">data-background-transition=</span><span class="s">&quot;slide&quot;</span><span class="nt">&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>data-transition

<ul>
<li>スライドに載っているコンテンツの動きを指定</li>
</ul>
</li>
<li>data-background-transition

<ul>
<li>スライド自体の動きを指定</li>
</ul>
</li>
</ul>


<h2>背景の設定</h2>

<p> <code>&lt;section&gt;</code>タグに<code>data-background</code>を指定することでスライドの背景を設定できる。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;section</span> <span class="na">data-background=</span><span class="s">&quot;#000000&quot;</span><span class="nt">&gt;</span>  <span class="c">&lt;!--背景色を指定--&gt;</span>
</span><span class='line'><span class="nt">&lt;section</span> <span class="na">data-background=</span><span class="s">&quot;img.jpg&quot;</span><span class="nt">&gt;</span>  <span class="c">&lt;!--背景画像をパスで指定--&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>コードブロックを設定</h2>

<p>コードブロックを挿入するには<code>&lt;pre&gt;&lt;code&gt;&lt;/code&gt;&lt;/pre&gt;</code>タグを挿入する。</p>

<p> <code>&lt;code&gt;</code>タグのclassに言語を指定することで適切なハイライトが適用される。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;section&gt;</span>
</span><span class='line'>    <span class="nt">&lt;pre&gt;&lt;code</span> <span class="na">class=</span><span class="s">&quot;html&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;body&gt;</span>
</span><span class='line'>            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;example&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>                test
</span><span class='line'>            <span class="nt">&lt;/div&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/body&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/code&gt;&lt;/pre&gt;</span>
</span><span class='line'><span class="nt">&lt;/section&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>スライド内コンテンツの動きの設定</h2>

<p>スライドのページ内でいくつかの動きを設定したいときは</p>

<ul>
<li><code>section</code>タグのidに<code>fragments</code>を指定する。</li>
<li>ページ内のコンテンツのclassに<code>fragment</code>を指定する。</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;section</span> <span class="na">id=</span><span class="s">&quot;fragments&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;h2&gt;</span>example<span class="nt">&lt;/h2&gt;</span>
</span><span class='line'>    <span class="nt">&lt;ol&gt;</span>
</span><span class='line'>        <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">&quot;fragment&quot;</span><span class="nt">&gt;</span>test1<span class="nt">&lt;/li&gt;</span>
</span><span class='line'>        <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">&quot;fragment&quot;</span><span class="nt">&gt;</span>test2<span class="nt">&lt;/li&gt;</span>
</span><span class='line'>        <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">&quot;fragment&quot;</span><span class="nt">&gt;</span>test3<span class="nt">&lt;/li&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/ol&gt;</span>
</span><span class='line'><span class="nt">&lt;/section&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>上記のように設定するとリストの要素が一つずつ出現する。</p>

<p> <code>fragment</code>classにはオプションを設定することができ、オプションによって動作をが変わる。</p>

<ul>
<li><code>class="fragment current-visible"</code>: 要素が出現する（デフォルト）</li>
<li><code>class="fragment grow"</code>: 要素が大きくなる</li>
<li><code>class="fragment shrink"</code>: 要素が小さくなる</li>
<li><code>class="fragment roll-in"</code>: 要素が回転しながら出現</li>
<li><code>class="fragment fade-out"</code>: 要素が消える</li>
<li><code>class="fragment highlight-green"</code>: 要素が指定した色になる(red, blueなども指定可能)</li>
<li><code>class="fragment highlight-current-blue"</code>: 要素が指定した色で出現する(red, greenなども指定可能)</li>
</ul>


<h2>マークダウンでの記述</h2>

<p>reveal.jsではプレゼンテーションをマークダウンで記述することもできる</p>

<ul>
<li><code>section</code>タグに<code>data-markdown</code>を指定</li>
<li><code>&lt;script type="text/template"&gt;&lt;/script&gt;</code>ブロック内に記述</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;section</span> <span class="na">data-markdown</span><span class="nt">&gt;</span>
</span><span class='line'><span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/template&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="err">#</span> <span class="err">ここに</span><span class="nx">markdown</span><span class="err">形式で記述</span>
</span><span class='line'>    <span class="err">```</span>
</span><span class='line'>    <span class="nx">echo</span> <span class="s2">&quot;you can also write code.&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="err">````</span>
</span><span class='line'><span class="nt">&lt;/script&gt;</span>
</span><span class='line'><span class="nt">&lt;/section&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>コードブロック内でも<code>&lt;/script&gt;</code>タグが出現するとマークダウンの終了と誤解されるので注意</p>

<h2>参考</h2>

<ul>
<li><a href="https://github.com/hakimel/reveal.js">GitHub</a></li>
<li><a href="http://qiita.com/budougumi0617/items/19b19019bbe01f86e251">Reveal.js、Markdown、Githubでスライドを作成する。</a></li>
<li><a href="http://qiita.com/ryurock/items/9c6de36b9d6a716e7992">なんかかっこいいプレゼンテーションテンプレートを探しているならreveal.js使ってみろって</a></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/08/25/howto-install-ag-in-amazon-linux-ami/">Amazon Linux AMIにagをインストールした手順</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-08-25T23:38:16+09:00'><span class='date'><span class='date-month'>Aug</span> <span class='date-day'>25</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>11:38 pm</span></time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><p>AWSでWebサーバーを借りた。このサーバーに<code>ag</code>をインストールした際の手順。</p>

<h2>agとは</h2>

<p>ソースコードから特定のwordを検索する際に使うコマンド<code>grep</code>がより賢く改良されたのが<code>ack</code>コマンド。</p>

<p>この<code>ack</code>をさらに改良し、検索を高速化させたのが<code>ag</code>コマンド（正式名称:The Silver Searcher）である。</p>

<h2>Amazon Linux AMIへのインストール</h2>

<p>MacにはHomebrewを使って<code>brew install the_silver_searcher</code>とするだけで簡単に入れることができた。</p>

<p>AWSで借りたサーバーはAmazon Linux AMIという独自のイメージだったが、<code>yum</code>が使えるのでCentOSと同じ以下の手順で入れることができた。</p>

<h3>ディレクトリの作成とソースのダウンロード</h3>

<p>ソースをダウンロード、インストールするディレクトリを作成し、gitから<code>ag</code>のソースを持ってくる</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>mkdir -p <span class="nv">$HOME</span>/local/source
</span><span class='line'><span class="nv">$ </span><span class="nb">cd</span> <span class="nv">$HOME</span>/local/source
</span><span class='line'><span class="nv">$ </span>git clone https://github.com/ggreer/the_silver_searcher
</span></code></pre></td></tr></table></div></figure>


<h3>ソースをmakeするための準備</h3>

<p>対象のサーバーはまっさらな状態でコンパイラなどもなかったため、それぞれインストールする。</p>

<p>前述の通りAmazon Linux AMIではyumを使うことができる</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>sudo su -
</span><span class='line'>yum -y groupinstall <span class="s2">&quot;Development Tools&quot;</span>
</span><span class='line'>yum -y install pcre-devel xz-devel
</span><span class='line'><span class="nb">exit</span>
</span></code></pre></td></tr></table></div></figure>


<h3>インストール</h3>

<p>コンパイルしてインストールする</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span><span class="nb">cd</span> <span class="nv">$HOME</span>/local/source/the_silver_searcher
</span><span class='line'><span class="nv">$ </span>./build.sh
</span><span class='line'><span class="nv">$ </span>sudo make install
</span></code></pre></td></tr></table></div></figure>


<h3>パスを通す</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span><span class="nb">cd</span>
</span><span class='line'><span class="nv">$ </span>vim .bashrc
</span><span class='line'><span class="nv">$ </span>cat .bashrc
</span><span class='line'>...
</span><span class='line'><span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="nv">$HOME</span>/local/bin:<span class="nv">$PATH</span>
</span><span class='line'>...
</span><span class='line'><span class="nv">$ </span><span class="nb">source</span> .bashrc
</span></code></pre></td></tr></table></div></figure>


<p>これで<code>ag</code>が使えるようになった</p>

<h2>参考</h2>

<ul>
<li><a href="https://github.com/ggreer/the_silver_searcher">the_silver_searcher</a></li>
<li><a href="http://qiita.com/sifue/items/55d0c5c11a0571af3b8e">grepやackよりも速いコード検索ツールのagをローカルビルドインストールする</a></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/08/22/add-users-on-aws-instance/">AWSに複数のユーザーを設定した手順</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-08-22T00:58:55+09:00'><span class='date'><span class='date-month'>Aug</span> <span class='date-day'>22</span><span class='date-suffix'>nd</span>, <span class='date-year'>2014</span></span> <span class='time'>12:58 am</span></time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><p>AWSでサーバーを借りて複数人で共同開発することになった。
それに伴い、借りたサーバーに各々がアクセスできるようユーザーの設定をした際の手順メモ。</p>

<h2>AWSでWEBサーバーを借りる</h2>

<p>AWSのWebサーバーレンタルサービスはEC2と呼ばれる。
サーバーをレンタルするには様々あるサービス群からEC2を選択し、<code>Launch Instance</code> ボタンを押してInstanceの立ち上げを開始する。</p>

<ul>
<li>AMI(Amazon Machine Image)の選択

<ul>
<li>借りるマシンの種類を選ぶ。用途によって様々な種類がある（WordPressが既に設定されているものなど）</li>
</ul>
</li>
<li>Instance Typeの選択

<ul>
<li>マシンのスペックを選ぶ。メモリやストレージのサイズなど</li>
</ul>
</li>
<li>Instanceの詳細設定</li>
<li>Storageの設定</li>
<li>Instanceへのtag付け</li>
<li>Security Groupの選択

<ul>
<li>アクセスを許可するプロトコルやIPなどを指定してその設定をグループとして扱う</li>
</ul>
</li>
</ul>


<p>上記のほとんどの設定は後から変更できる。AMIの選択がしっかりできれば問題なさそう。</p>

<p>最後まで完了すると秘密鍵(hogehoge.pem)が発行される。これは絶対になくしてはいけない。</p>

<h2>立ち上げたInstanceに複数ユーザーを設定する</h2>

<p>立ち上げたInstanceにアクセスする。
今回はWebサーバーとして立ち上げるのでSecurity GroupにはHTTPとSSHでのアクセスを許可するよう設定しておく。</p>

<h3>秘密鍵でアクセスする</h3>

<p>まずはInstance立ち上げ時に発行された秘密鍵でアクセスする</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>sojiro@local ~<span class="o">]</span><span class="nv">$ </span>chmod <span class="m">600</span> hogehoge.pem  <span class="c"># 秘密鍵の権限を設定（厳しすぎても甘過ぎても使えない）</span>
</span><span class='line'><span class="o">[</span>sojiro@local ~<span class="o">]</span><span class="nv">$ </span>ssh -i hogehoge.pem ec2-user@xx.xx.xx.xxx  <span class="c"># ec2-userでログイン</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>ダウンロード直後の秘密鍵は権限が適切ではない可能性がある。その場合は600に設定する。</li>
<li><code>ssh</code>の<code>-i</code>オプションを使って秘密鍵を指定してログイン（秘密鍵を指定しないと~/.ssh/id_rsaが使われる）

<ul>
<li>最初は初期設定されているec2-userというユーザーでログインする</li>
<li>コマンドはEC2のメニューバーからInstancesページに行き、Instanceを選択してページ上部の<code>Connect</code>ボタンを押すと表示される</li>
</ul>
</li>
</ul>


<h3>ユーザーの作成</h3>

<p>Instanceにログインできたら早速ユーザーを作成していく</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>ec2-user@ip-hogehoge ~<span class="o">]</span><span class="nv">$ </span>sudo su -  <span class="c"># rootユーザーになる</span>
</span><span class='line'><span class="o">[</span>root@ip-hogehoge ~<span class="o">]</span> adduser sojiro  <span class="c"># ユーザー(sojiro)を作成</span>
</span><span class='line'><span class="o">[</span>root@ip-hogehoge ~<span class="o">]</span> passwd sojiro   <span class="c"># sojiroにパスワードを設定</span>
</span><span class='line'><span class="o">[</span>root@ip-hogehoge ~<span class="o">]</span> vim /etc/sudoers  <span class="c"># sojiroに権限を設定</span>
</span></code></pre></td></tr></table></div></figure>


<p>ユーザーを作り、ユーザーに権限を付与する。今回は大雑把にrootと同じことができる権限を付与。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>root@ip-hogehoge ~<span class="o">]</span> cat /etc/sudors
</span><span class='line'>...
</span><span class='line'>root    <span class="nv">ALL</span><span class="o">=(</span>ALL<span class="o">)</span>       ALL
</span><span class='line'>sojiro  <span class="nv">ALL</span><span class="o">=(</span>ALL<span class="o">)</span>       ALL
</span><span class='line'>...
</span></code></pre></td></tr></table></div></figure>


<h3>公開鍵の登録</h3>

<p>作成したユーザーにlocalからアクセスするための公開鍵を設定する。
（鍵のペアはlocalで予め<code>ssh-keygen -t rsa</code>で作成しておく）</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>root@ip-hogehoge ~<span class="o">]</span> su sojiro
</span><span class='line'><span class="o">[</span>sojiro@ip-hogehoge root<span class="o">]</span><span class="nv">$ </span><span class="nb">cd</span>  <span class="c"># sojiroのホームディレクトリに移動</span>
</span><span class='line'><span class="o">[</span>sojiro@ip-hogehoge ~<span class="o">]</span><span class="nv">$ </span>mkdir .ssh
</span><span class='line'><span class="o">[</span>sojiro@ip-hogehoge ~<span class="o">]</span><span class="nv">$ </span>vim .ssh/authorized_keys  <span class="c"># 公開鍵を置く（今回はlocalのid_rsa.pubをコピペした）</span>
</span><span class='line'><span class="o">[</span>sojiro@ip-hogehoge ~<span class="o">]</span><span class="nv">$ </span>chmod <span class="m">700</span> .ssh
</span><span class='line'><span class="o">[</span>sojiro@ip-hogehoge ~<span class="o">]</span><span class="nv">$ </span>chmod <span class="m">600</span> .ssh/authorized_keys
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>公開鍵を置くファイルの名前は<code>.ssh</code>ディレクトリ配下の<code>authorized_keys</code>と決まっている</li>
<li><code>.ssh</code>ディレクトリと<code>authorized_keys</code>の権限にも気をつける</li>
</ul>


<h3>作成したユーザーでInstanceにログインできることを確認</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>sojiro@local ~<span class="o">]</span><span class="nv">$ </span>ssh sojiro@xx.xx.xx.xxx  <span class="c"># ログインできればOK</span>
</span></code></pre></td></tr></table></div></figure>


<p>localのrsa鍵でログインできることを確認できれば完了。</p>

<p>この操作で必要なユーザーを適宜作成する。</p>

<h2>参考</h2>

<p><a href="http://d.hatena.ne.jp/torazuka/20110420/ssh">新規に作成した鍵でEC2インスタンスにSSH接続する</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/08/09/add-disqus-comment-section-on-my-blog-by-octopress/">OctopressにDISQUSのコメント欄を導入する</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-08-09T16:02:24+09:00'><span class='date'><span class='date-month'>Aug</span> <span class='date-day'>9</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>4:02 pm</span></time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><h2>ブログにコメント欄を追加したい</h2>

<p>本ブログにコメント欄を追加しようと思い立った。</p>

<p><a href="https://disqus.com/">DISQUS</a>というコミュニケーションサービスが好評のようなので導入してみる。</p>

<ul>
<li>DISQUSを使うための準備</li>
<li>OctopressでのDISQUS導入方法</li>
</ul>


<h2>DISQUSを使うための準備</h2>

<h3>DISQUSのアカウントを作成する</h3>

<p><a href="https://disqus.com/">DISQUS</a>のWebサイトからアカウントを作成。登録に必要なのはメールアドレスのみ。</p>

<h3>自分のWebサイトをDISQUSに登録する</h3>

<p>DISQUSの<a href="https://disqus.com/admin/create/">サイト登録ページ</a>から自分のサイトを登録する</p>

<p>登録が完了すると設定ページが表示されるので、ここで設定をしつつ、ページ中段に表示されている<code>Shortname</code>の文字列を確認する</p>

<h2>OctopressでのDISQUS導入方法</h2>

<h3>configファイルへの記載</h3>

<p>OctopressでのDISQUS導入はconfigファイルに先ほどDISQUSで取得したShortnameを記載するのみで完了する。</p>

<p> <code>_config.yml</code> の<code>disqus_short_name</code>に自分のサイトのShortnameを指定する。</p>

<figure class='code'><figcaption><span>_config.yml</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="c1"># Disqus Comments</span>
</span><span class='line'><span class="l-Scalar-Plain">disqus_short_name</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">yoursitesshortname</span>
</span><span class='line'><span class="l-Scalar-Plain">disqus_show_comment_count</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">false</span>
</span></code></pre></td></tr></table></div></figure>


<p>これでブログの各ページの下部にDISQUSのコメント欄が表示されるようになる。</p>

<h3>disqus_show_comment_count</h3>

<p><code>disqus_show_comment_count</code> はDISQUSコメント欄を導入するページのヘッダにコメント欄へのリンクを表示させるかどうかを指定する項目。</p>

<h4>trueのとき</h4>

<p><img src="/images/disqus/header_with_comment_link.png"></p>

<h4>falseのとき</h4>

<p><img src="/images/disqus/header_without_comment_link.png"></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/07/31/irc-bot-by-hubot-repair-number-1/">HUBOTを使ったirc-bot改修メモ #1 -noticeで発言させる-</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-07-31T04:45:04+09:00'><span class='date'><span class='date-month'>Jul</span> <span class='date-day'>31</span><span class='date-suffix'>st</span>, <span class='date-year'>2014</span></span> <span class='time'>4:45 am</span></time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="http://sojiro14.github.io/blog/2014/04/19/irc-bot-by-hubot/">こちらの記事</a>でつくったirc-botの発言をnoticeにしたい。（botの発言内容に名前やALLなどの文字列が含まれると当人にmentionが飛んでしまうため）</p>

<h2>HUBOT_IRC_SEND_NOTICE_MODE</h2>

<p>環境変数 <code>HUBOT_IRC_SEND_NOTICE_MODE</code> を <code>true</code> とすれば良い</p>

<p>実行ファイル(runhubot)に追記</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c">#!/bin/bash</span>
</span><span class='line'>
</span><span class='line'><span class="nb">export </span><span class="nv">HUBOT_IRC_NICK</span><span class="o">=</span><span class="s2">&quot;bot_kun&quot;</span>
</span><span class='line'><span class="nb">export </span><span class="nv">HUBOT_IRC_ROOMS</span><span class="o">=</span><span class="s2">&quot;#target_channel&quot;</span>
</span><span class='line'><span class="nb">export </span><span class="nv">HUBOT_IRC_SERVER</span><span class="o">=</span><span class="s2">&quot;irc.hogehoge.local&quot;</span>
</span><span class='line'><span class="nb">export </span><span class="nv">HUBOT_IRC_SEND_NOTICE_MODE</span><span class="o">=</span><span class="nb">true</span>
</span><span class='line'><span class="c">#export HUBOT_IRC_PASSWORD=&quot;hoge&quot;</span>
</span><span class='line'>
</span><span class='line'>bin/hubot -a irc --name myhubot
</span></code></pre></td></tr></table></div></figure>


<p>この実行ファイルからirc-botを起動すると当該irc-botの発言はすべてnoticeとなる。</p>

<h2>処理の実体</h2>

<p>HUBOT_IRC_SEND_NOTICE_MODEフラグが立っている場合は <code>bot</code> オブジェクトから <code>notice</code> メソッドが呼ばれる。</p>

<ul>
<li><a href="https://github.com/nandub/hubot-irc/blob/master/src/irc.coffee#L18">フラグの確認</a></li>
<li><a href="https://github.com/nandub/hubot-irc/blob/master/src/irc.coffee#L56-76">noticeメソッド呼び出し</a></li>
</ul>


<p><code>notice</code> メソッドが呼ばれている <code>bot</code> オブジェクトの実体は <code>new Irc.Client</code> である。</p>

<ul>
<li><a href="https://github.com/nandub/hubot-irc/blob/master/src/irc.coffee#L192">botオブジェクトの生成</a></li>
</ul>


<p>参考: <a href="http://node-irc.readthedocs.org/en/latest/API.html">http://node-irc.readthedocs.org/en/latest/API.html</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/07/27/rediss-data-type-and-usage/">Redisに用意されたデータ型とその扱い</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-07-27T00:47:21+09:00'><span class='date'><span class='date-month'>Jul</span> <span class='date-day'>27</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>12:47 am</span></time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><h2>Redisで扱えるデータ型</h2>

<ul>
<li>String</li>
<li>List</li>
<li>Set</li>
<li>Sorted Set</li>
<li>Hash</li>
</ul>


<h2>String</h2>

<p>文字列型</p>

<p>文字列や数値など、Keyに対して1つに定まる値。</p>

<h3>値のset</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">set</span> <span class="o">[</span>key_name<span class="o">]</span> <span class="o">[</span>value<span class="o">]</span>  <span class="c"># 1つのkey-valueをsetする</span>
</span><span class='line'>mset <span class="o">[</span>key_name_1<span class="o">]</span> <span class="o">[</span>value_1<span class="o">]</span> <span class="o">[</span>key_name_2<span class="o">]</span> <span class="o">[</span>value_2<span class="o">]</span>  <span class="c"># key-valueの組を複数setする</span>
</span></code></pre></td></tr></table></div></figure>


<h3>値のget</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>get <span class="o">[</span>key_name<span class="o">]</span>  <span class="c"># 1つのkeyに対するvalueをgetする</span>
</span><span class='line'>mget <span class="o">[</span>key_name_1<span class="o">]</span> <span class="o">[</span>key_name_2<span class="o">]</span> <span class="o">[</span>key_name_3<span class="o">]</span>  <span class="c"># 複数のkeyに対するvalueをgetする</span>
</span></code></pre></td></tr></table></div></figure>


<h3>使用例</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>redis&gt; <span class="nb">set </span>name Steven
</span><span class='line'>OK
</span><span class='line'>redis&gt; get name
</span><span class='line'><span class="s2">&quot;Steven&quot;</span>
</span><span class='line'>redis&gt; mset number <span class="m">8</span> color red
</span><span class='line'>OK
</span><span class='line'>redis&gt; mget name number color
</span><span class='line'>1<span class="o">)</span> <span class="s2">&quot;Steven&quot;</span>
</span><span class='line'>2<span class="o">)</span> <span class="s2">&quot;8&quot;</span>
</span><span class='line'>3<span class="o">)</span> <span class="s2">&quot;red&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>List</h2>

<p>リスト型</p>

<p>順番をもった値の集合。</p>

<h3>値の追加</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>rpush <span class="o">[</span>key_name<span class="o">]</span> <span class="o">[</span>member<span class="o">]</span>  <span class="c"># リストの末尾に値を追加</span>
</span><span class='line'>lpush <span class="o">[</span>key_name<span class="o">]</span> <span class="o">[</span>member<span class="o">]</span>  <span class="c"># リストの先頭に値を追加</span>
</span></code></pre></td></tr></table></div></figure>


<h3>値の削除</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>rpop <span class="o">[</span>key_name<span class="o">]</span>  <span class="c"># リストの末尾の値を削除</span>
</span><span class='line'>lpop <span class="o">[</span>key_name<span class="o">]</span>  <span class="c"># リストの先頭の値を削除</span>
</span></code></pre></td></tr></table></div></figure>


<h3>範囲を指定して値を取得</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>lrange <span class="o">[</span>key_name<span class="o">]</span> <span class="m">0</span> <span class="m">3</span>   <span class="c"># 1番目から4番目まで値を取得</span>
</span><span class='line'>lrange <span class="o">[</span>key_name<span class="o">]</span> <span class="m">0</span> -1  <span class="c"># 1番目から最後（最後から1番目）までの値を取得</span>
</span></code></pre></td></tr></table></div></figure>


<h3>位置を指定して値を取得</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>lindex <span class="o">[</span>key_name<span class="o">]</span> <span class="m">2</span>   <span class="c"># 3番目の値を取得</span>
</span><span class='line'>lindex <span class="o">[</span>key_name<span class="o">]</span> -1  <span class="c"># 最後の値を取得</span>
</span></code></pre></td></tr></table></div></figure>


<h3>要素の数を取得</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>llen <span class="o">[</span>key<span class="o">]</span>
</span></code></pre></td></tr></table></div></figure>


<h3>使用例</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>redis&gt; rpush player Steven
</span><span class='line'>redis&gt; rpush player Michael James
</span><span class='line'>redis&gt; lrange player <span class="m">0</span> -1
</span><span class='line'>1<span class="o">)</span> <span class="s2">&quot;Steven&quot;</span>
</span><span class='line'>2<span class="o">)</span> <span class="s2">&quot;Michael&quot;</span>
</span><span class='line'>3<span class="o">)</span> <span class="s2">&quot;James&quot;</span>
</span><span class='line'>redis&gt; lrange player <span class="m">0</span> 1
</span><span class='line'>1<span class="o">)</span> <span class="s2">&quot;Steven&quot;</span>
</span><span class='line'>2<span class="o">)</span> <span class="s2">&quot;Michael&quot;</span>
</span><span class='line'>redis&gt; lindex player 1
</span><span class='line'><span class="s2">&quot;Michael&quot;</span>
</span><span class='line'>redis&gt; lindex player -1
</span><span class='line'><span class="s2">&quot;James&quot;</span>
</span><span class='line'>redis&gt; rpop player
</span><span class='line'><span class="s2">&quot;James&quot;</span>
</span><span class='line'>redis&gt; lrange player <span class="m">0</span> -1
</span><span class='line'>1<span class="o">)</span> <span class="s2">&quot;Steven&quot;</span>
</span><span class='line'>2<span class="o">)</span> <span class="s2">&quot;Michael&quot;</span>
</span><span class='line'>redis&gt; llen player
</span><span class='line'><span class="o">(</span>integer<span class="o">)</span> 2
</span></code></pre></td></tr></table></div></figure>


<h2>Set</h2>

<p>セット型</p>

<p>順不同の値の集合。値の重複を許さない。</p>

<h3>値の追加</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sadd <span class="o">[</span>key_name<span class="o">]</span> <span class="o">[</span>member<span class="o">]</span>  <span class="c"># keyに対応するセットに指定した値を追加</span>
</span></code></pre></td></tr></table></div></figure>


<h3>値の削除</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>srem <span class="o">[</span>key_name<span class="o">]</span> <span class="o">[</span>member<span class="o">]</span>  <span class="c"># keyに対応するセットから指定した値を削除</span>
</span></code></pre></td></tr></table></div></figure>


<h3>値の参照</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>smembers <span class="o">[</span>key_name<span class="o">]</span>  <span class="c"># keyに対応するセットの値を取得</span>
</span></code></pre></td></tr></table></div></figure>


<h3>和集合の取得</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sunion <span class="o">[</span>key_name_1<span class="o">]</span> <span class="o">[</span>key_name_2<span class="o">]</span>  <span class="c"># key1に対応するセットとkey2に対応するセットの値の集合を取得</span>
</span></code></pre></td></tr></table></div></figure>


<h3>差集合の取得</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sdiff <span class="o">[</span>key_name_1<span class="o">]</span> <span class="o">[</span>key_name_2<span class="o">]</span>  <span class="c"># key1に対応するセットとkey2に対応するセットの値の差分の集合を取得</span>
</span></code></pre></td></tr></table></div></figure>


<h3>積集合の取得</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sinter <span class="o">[</span>key_name_1<span class="o">]</span> <span class="o">[</span>key_name_2<span class="o">]</span>  <span class="c"># key1に対応するセットとkey2に対応するセットの値の重複部分の集合を取得</span>
</span></code></pre></td></tr></table></div></figure>


<h3>使用例</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>redis&gt; sadd reds Steven
</span><span class='line'><span class="o">(</span>integer<span class="o">)</span> 1
</span><span class='line'>redis&gt; smembers reds
</span><span class='line'>1<span class="o">)</span> <span class="s2">&quot;Steven&quot;</span>
</span><span class='line'>redis&gt; sadd reds Steve
</span><span class='line'><span class="o">(</span>integer<span class="o">)</span> 1
</span><span class='line'>redis&gt; sadd reds Michael
</span><span class='line'><span class="o">(</span>integer<span class="o">)</span> 1
</span><span class='line'>redis&gt; smembers reds
</span><span class='line'>1<span class="o">)</span> <span class="s2">&quot;Steven&quot;</span>
</span><span class='line'>2<span class="o">)</span> <span class="s2">&quot;Michael&quot;</span>
</span><span class='line'>3<span class="o">)</span> <span class="s2">&quot;Steve&quot;</span>
</span><span class='line'>redis&gt; srem reds Michael
</span><span class='line'><span class="o">(</span>integer<span class="o">)</span> 1
</span><span class='line'>redis&gt; smembers reds
</span><span class='line'>1<span class="o">)</span> <span class="s2">&quot;Steven&quot;</span>
</span><span class='line'>2<span class="o">)</span> <span class="s2">&quot;Steve&quot;</span>
</span><span class='line'>redis&gt; sadd three_lions Steven Michael
</span><span class='line'><span class="o">(</span>integer<span class="o">)</span> 2
</span><span class='line'>redis&gt; smembers three_lions
</span><span class='line'>1<span class="o">)</span> <span class="s2">&quot;Steven&quot;</span>
</span><span class='line'>2<span class="o">)</span> <span class="s2">&quot;Michael&quot;</span>
</span><span class='line'>redis&gt; sunion reds three_lions
</span><span class='line'>1<span class="o">)</span> <span class="s2">&quot;Steven&quot;</span>
</span><span class='line'>2<span class="o">)</span> <span class="s2">&quot;Michael&quot;</span>
</span><span class='line'>3<span class="o">)</span> <span class="s2">&quot;Steve&quot;</span>
</span><span class='line'>redis&gt; sdiff reds three_lions
</span><span class='line'>1<span class="o">)</span> <span class="s2">&quot;Steve&quot;</span>
</span><span class='line'>redis&gt; sdiff three_lions reds  <span class="c"># sdiffの後のkeyの順番により結果が違うことに注意</span>
</span><span class='line'>1<span class="o">)</span> <span class="s2">&quot;Michael&quot;</span>
</span><span class='line'>redis&gt; sinter reds three_lions
</span><span class='line'>1<span class="o">)</span> <span class="s2">&quot;Steven&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Sorted Set</h2>

<p>ソート済みセット型</p>

<p>セット型と同様の特徴に加えて個々の値がスコアを持つ。</p>

<h3>値の追加</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>zadd <span class="o">[</span>key_name<span class="o">]</span> <span class="o">[</span>score<span class="o">]</span> <span class="o">[</span>member<span class="o">]</span>  <span class="c"># keyに対応するセットにスコア付きで値を追加</span>
</span></code></pre></td></tr></table></div></figure>


<h3>値の削除</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>zrem <span class="o">[</span>key_name<span class="o">]</span> <span class="o">[</span>member<span class="o">]</span>  <span class="c"># keyに対応するセットから指定した値を削除</span>
</span></code></pre></td></tr></table></div></figure>


<h3>値の取得</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>zrange <span class="o">[</span>key_name<span class="o">]</span> <span class="m">0</span> <span class="m">3</span>     <span class="c"># keyに対応するセットからスコアの低い順に1番目から4番目の値を取得</span>
</span><span class='line'>zrevrange <span class="o">[</span>key_name<span class="o">]</span> <span class="m">0</span> <span class="m">3</span>  <span class="c"># keyに対応するセットからスコアの高い順に1番目から4番目の値を取得</span>
</span></code></pre></td></tr></table></div></figure>


<h3>値の順位を取得</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>zrank <span class="o">[</span>key_name<span class="o">]</span> <span class="o">[</span>member<span class="o">]</span>     <span class="c"># 指定した値の、keyに対応するセット中のランクを取得（スコアの低い順）</span>
</span><span class='line'>zrevrank <span class="o">[</span>key_name<span class="o">]</span> <span class="o">[</span>member<span class="o">]</span>  <span class="c"># 指定した値の、keyに対応するセット中のランクを取得（スコアの高い順）</span>
</span></code></pre></td></tr></table></div></figure>


<h3>使用例</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>redis&gt; zadd fifa <span class="m">1</span> germany
</span><span class='line'><span class="o">(</span>integer<span class="o">)</span> 1
</span><span class='line'>redis&gt; zrange fifa <span class="m">0</span> 0
</span><span class='line'>1<span class="o">)</span> <span class="s2">&quot;germany&quot;</span>
</span><span class='line'>redis&gt; zadd fifa <span class="m">2</span> argentina
</span><span class='line'><span class="o">(</span>integer<span class="o">)</span> 1
</span><span class='line'>redis&gt; zadd fifa <span class="m">3</span> holland <span class="m">4</span> colombia <span class="m">45</span> japan
</span><span class='line'><span class="o">(</span>integer<span class="o">)</span> 3
</span><span class='line'>redis&gt; zrange fifa <span class="m">0</span> -1
</span><span class='line'>1<span class="o">)</span> <span class="s2">&quot;germany&quot;</span>
</span><span class='line'>2<span class="o">)</span> <span class="s2">&quot;argentina&quot;</span>
</span><span class='line'>3<span class="o">)</span> <span class="s2">&quot;holland&quot;</span>
</span><span class='line'>4<span class="o">)</span> <span class="s2">&quot;colombia&quot;</span>
</span><span class='line'>5<span class="o">)</span> <span class="s2">&quot;japan&quot;</span>
</span><span class='line'>redis&gt; zrevrange fifa <span class="m">0</span> -1
</span><span class='line'>1<span class="o">)</span> <span class="s2">&quot;japan&quot;</span>
</span><span class='line'>2<span class="o">)</span> <span class="s2">&quot;colombia&quot;</span>
</span><span class='line'>3<span class="o">)</span> <span class="s2">&quot;holland&quot;</span>
</span><span class='line'>4<span class="o">)</span> <span class="s2">&quot;argentina&quot;</span>
</span><span class='line'>5<span class="o">)</span> <span class="s2">&quot;germany&quot;</span>
</span><span class='line'>redis&gt; zrank fifa japan
</span><span class='line'><span class="o">(</span>integer<span class="o">)</span> <span class="m">4</span>                      <span class="c"># 0番目から数えた値が返るので注意</span>
</span><span class='line'>redis&gt; zrevrank fifa argentina
</span><span class='line'><span class="o">(</span>integer<span class="o">)</span> <span class="m">3</span>                      <span class="c"># 0番目から数えた値が返るので注意</span>
</span><span class='line'>redis&gt; zrem fifa japan
</span><span class='line'><span class="o">(</span>integer<span class="o">)</span> 1
</span><span class='line'>redis&gt; zrange fifa <span class="m">0</span> -1
</span><span class='line'>1<span class="o">)</span> <span class="s2">&quot;germany&quot;</span>
</span><span class='line'>2<span class="o">)</span> <span class="s2">&quot;argentina&quot;</span>
</span><span class='line'>3<span class="o">)</span> <span class="s2">&quot;holland&quot;</span>
</span><span class='line'>4<span class="o">)</span> <span class="s2">&quot;colombia&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Hash</h2>

<p>ハッシュ型</p>

<p>field（valueについた名前）とvalueを1セットとする値の集合（ハッシュ）。</p>

<h3>値のset</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>hset <span class="o">[</span>key_name<span class="o">]</span> <span class="o">[</span>field<span class="o">]</span> <span class="o">[</span>value<span class="o">]</span>  <span class="c"># keyにfieldとvalueのハッシュをset</span>
</span><span class='line'>hmset <span class="o">[</span>key_name<span class="o">]</span> <span class="o">[</span>field_1<span class="o">]</span> <span class="o">[</span>value_1<span class="o">]</span> <span class="o">[</span>field_2<span class="o">]</span> <span class="o">[</span>value_2<span class="o">]</span>  <span class="c"># keyにハッシュのfieldとvalueを複数セット</span>
</span></code></pre></td></tr></table></div></figure>


<h3>値のget</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>hget <span class="o">[</span>key_name<span class="o">]</span> <span class="o">[</span>field<span class="o">]</span>               <span class="c"># keyに対応するハッシュから指定したfieldのvalueを取得</span>
</span><span class='line'>hmget <span class="o">[</span>key_name<span class="o">]</span> <span class="o">[</span>field_1<span class="o">]</span> <span class="o">[</span>field_2<span class="o">]</span>  <span class="c"># keyに対応するハッシュから指定した複数のfieldのvalueを取得</span>
</span><span class='line'>hkeys <span class="o">[</span>key_name<span class="o">]</span>                      <span class="c"># keyに対応するハッシュのすべてのfieldを取得</span>
</span><span class='line'>hvals <span class="o">[</span>key_name<span class="o">]</span>                      <span class="c"># keyに対応するハッシュのすべてのvalueを取得</span>
</span></code></pre></td></tr></table></div></figure>


<h3>使用例</h3>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>redis&gt; hset steven position mf
</span><span class='line'><span class="o">(</span>integer<span class="o">)</span> 1
</span><span class='line'>redis&gt; hget steven position
</span><span class='line'><span class="s2">&quot;mf&quot;</span>
</span><span class='line'>redis&gt; hmset steven nationality england club reds
</span><span class='line'>OK
</span><span class='line'>redis&gt; hmget steven club position
</span><span class='line'>1<span class="o">)</span> <span class="s2">&quot;reds&quot;</span>
</span><span class='line'>2<span class="o">)</span> <span class="s2">&quot;mf&quot;</span>
</span><span class='line'>redis&gt; hkeys steven
</span><span class='line'>1<span class="o">)</span> <span class="s2">&quot;position&quot;</span>
</span><span class='line'>2<span class="o">)</span> <span class="s2">&quot;nationality&quot;</span>
</span><span class='line'>3<span class="o">)</span> <span class="s2">&quot;club&quot;</span>
</span><span class='line'>redis&gt; hvals steven
</span><span class='line'>1<span class="o">)</span> <span class="s2">&quot;mf&quot;</span>
</span><span class='line'>2<span class="o">)</span> <span class="s2">&quot;england&quot;</span>
</span><span class='line'>3<span class="o">)</span> <span class="s2">&quot;reds&quot;</span>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/07/17/html5-canvas-number-1/">HTML5 Canvas #1 -Canvasを初めて使う-</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2014-07-17T02:13:46+09:00'><span class='date'><span class='date-month'>Jul</span> <span class='date-day'>17</span><span class='date-suffix'>th</span>, <span class='date-year'>2014</span></span> <span class='time'>2:13 am</span></time>
        
        
      </p>
    
  </header>


  <div class="entry-content"><h1>Canvasとは</h1>

<ul>
<li>ブラウザ上に図形を描画するためのHTML5の仕様の一つ</li>
<li>プラグインを使わずにJavaScriptベースで図形を描画することができる。</li>
<li>アニメーションメソッドはないので動きをつけるためには1コマずつ描画し直す必要がある</li>
</ul>


<p>今回はCanvasを使った図形の描画とそれを動的に消す操作をしてみる。</p>

<h1>今回使う要素</h1>

<ul>
<li>メソッド

<ul>
<li>getContext()</li>
<li>fillRect()</li>
<li>clearRect()</li>
</ul>
</li>
<li>プロパティ

<ul>
<li>fillStyle</li>
</ul>
</li>
</ul>


<h2>getContext()</h2>

<p>Canvasはこのメソッドから始まる</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">var</span> <span class="nx">targetElement</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;target&#39;</span><span class="p">);</span>
</span><span class='line'><span class="nx">ctx</span> <span class="o">=</span> <span class="nx">targetElement</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s1">&#39;2d&#39;</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p> <code>getElementById</code> などでCanvasの対象となるDOM要素を取得し、その要素に対して <code>getContext()</code> メソッドを呼ぶ</p>

<p>引数は <code>'2d'</code> のみが認められている。（今後&#8217;3d&#8217;とかつかえるようになるかも）</p>

<p> <code>getContext('2d')</code> で取得した <code>ctx</code> オブジェクトに対してメソッドやプロパティを適用していく</p>

<h2>fillRect()</h2>

<p>canvas上の指定した位置に指定した大きさの長方形を描画する</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">ctx</span><span class="p">.</span><span class="nx">fillRect</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">40</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p> <code>fillRect()</code> メソッドは4つの引数を取る。</p>

<ul>
<li>1つめ: 描画する長方形の左上頂点の<strong>x座標</strong></li>
<li>2つめ: 描画する長方形の左上頂点の<strong>y座標</strong></li>
<li>3つめ: 描画する長方形の<strong>幅</strong></li>
<li>4つめ: 描画する長方形の<strong>高さ</strong></li>
</ul>


<p>上記例ではcanvasの左上頂点（原点）から</p>

<ul>
<li>右方向（x軸方向）に80px</li>
<li>下方向（y軸方向）に100px</li>
</ul>


<p>の点に左上の頂点を持つ、</p>

<ul>
<li>幅40px</li>
<li>高さ40px</li>
</ul>


<p>の長方形（正方形）を描画することになる</p>

<h2>clearRect()</h2>

<p>指定された長方形を消す</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">ctx</span><span class="p">.</span><span class="nx">clearRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">400</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p> <code>clearRect()</code> は <code>fillRect()</code> 同様に4つの引数を取る</p>

<ul>
<li>1つめ: 消す長方形の左上頂点の<strong>x座標</strong></li>
<li>2つめ: 消す長方形の左上頂点の<strong>y座標</strong></li>
<li>3つめ: 消す長方形の<strong>幅</strong></li>
<li>4つめ: 消す長方形の<strong>高さ</strong></li>
</ul>


<p>よって上記例ではcanvasの原点から幅200px、高さ400pxの長方形（範囲）に渡ってクリアする</p>

<h2>fillStyle</h2>

<p>オブジェクトのStyleを変更する</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">ctx</span><span class="p">.</span><span class="nx">fillStyle</span> <span class="o">=</span> <span class="s1">&#39;rgb(255, 0, 0)&#39;</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>主にオブジェクトの色を指定するのに使う（Canvasではデフォルトの色は黒）</p>

<p>指定の仕方はCSSに準拠している</p>

<p>上記例ではオブジェクトを赤で描画できるようになる</p>

<h1>サンプル</h1>

<p>赤い正方形を描いたり消したりする</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="cp">&lt;!DOCTYPE html&gt;</span>
</span><span class='line'><span class="nt">&lt;html&gt;</span>
</span><span class='line'>    <span class="nt">&lt;head&gt;</span>
</span><span class='line'>        <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">utf-8</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;title&gt;</span>Canvas Sample1<span class="nt">&lt;/title&gt;</span>
</span><span class='line'>        <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">&quot;text/javascript&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>            <span class="kd">var</span> <span class="nx">ctx</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>            <span class="kd">function</span> <span class="nx">load</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>                <span class="kd">var</span> <span class="nx">targetElement</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;target&#39;</span><span class="p">);</span>
</span><span class='line'>                <span class="nx">ctx</span> <span class="o">=</span> <span class="nx">targetElement</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="s1">&#39;2d&#39;</span><span class="p">);</span>
</span><span class='line'>                <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillStyle</span> <span class="o">=</span> <span class="s1">&#39;rgb(255, 0, 0)&#39;</span><span class="p">;</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>            <span class="kd">function</span> <span class="nx">paint</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>                <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillRect</span><span class="p">(</span><span class="mi">80</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">40</span><span class="p">);</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>            <span class="kd">function</span> <span class="nx">erase</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>                <span class="nx">ctx</span><span class="p">.</span><span class="nx">clearRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">400</span><span class="p">);</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>        <span class="nt">&lt;/script&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/head&gt;</span>
</span><span class='line'>    <span class="nt">&lt;body</span> <span class="na">onload=</span><span class="s">&quot;load()&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>        <span class="nt">&lt;canvas</span> <span class="na">id=</span><span class="s">&quot;target&quot;</span> <span class="na">style=</span><span class="s">&quot;border: 5px solid gray&quot;</span> <span class="na">width=</span><span class="s">&quot;200&quot;</span> <span class="na">height=</span><span class="s">&quot;400&quot;</span><span class="nt">&gt;&lt;/canvas&gt;</span>
</span><span class='line'>        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;button&quot;</span> <span class="na">value=</span><span class="s">&quot;Paint&quot;</span> <span class="na">onclick=</span><span class="s">&quot;paint()&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>        <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">&quot;button&quot;</span> <span class="na">value=</span><span class="s">&quot;Erase&quot;</span> <span class="na">onclick=</span><span class="s">&quot;erase()&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/body&gt;</span>
</span><span class='line'><span class="nt">&lt;/html&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>幅200px、高さ400pxのcanvasを用意し、そこに正方形を描くpaint関数とクリアするerase関数を定義した</p>

<h2>参考資料</h2>

<ul>
<li><a href="http://www.html5.jp/canvas/index.html">HTML5.jp Canvas</a></li>
</ul>

</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/page8">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/page6">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>About Me</h1>
  <p>A little something about me.</p>
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2017/08/25/value-object-and-collection-object/">値オブジェクトとコレクションオブジェクト</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/06/19/wordpress-on-gae/">WordPress on GAE</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/06/18/unix-time-handling/">Unix timeの扱い</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/06/17/copy-output-to-clipboard/">ファイルの内容を直接クリップボードに出力する</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/06/16/could-not-open-the-requested-socket-on-android-studio/">Could not open the requested socket エラーが出たら</a>
      </li>
    
  </ul>
</section>

  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2017 - Sojiro -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a> | Themed with <a href="https://github.com/lucaslew/whitespace">Whitespace</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'sojirosblog';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>






<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>





  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>

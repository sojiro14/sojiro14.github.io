<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Chef | Sojiro's Blog]]></title>
  <link href="http://sojiro14.github.io/blog/categories/chef/atom.xml" rel="self"/>
  <link href="http://sojiro14.github.io/"/>
  <updated>2015-11-14T20:32:53+09:00</updated>
  <id>http://sojiro14.github.io/</id>
  <author>
    <name><![CDATA[Sojiro]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[初めてのChef]]></title>
    <link href="http://sojiro14.github.io/blog/2015/11/01/the-first-step-of-chef/"/>
    <updated>2015-11-01T02:17:51+09:00</updated>
    <id>http://sojiro14.github.io/blog/2015/11/01/the-first-step-of-chef</id>
    <content type="html"><![CDATA[<p>Chef を使ってみます。
Vagrant で環境をつくっておいてそこで色々試してみます。</p>

<p>今回はゲスト側でクックブック、レシピを作って実行してみます。</p>

<h2>Chef のインストール</h2>

<p> <code>vagrant ssh</code> で Vagrant の環境に入って Chef をインストールする</p>

<pre><code class="bash">$ curl -L https://www.opscode.com/chef/install.sh | sudo bash
...
Thank you for installing Chef!
</code></pre>

<p>Chef Solo がインストールされているか確認
<code>bash
$ chef-solo -v
Chef: 12.5.1
</code></p>

<h2>クックブックを作る</h2>

<p>Chef をインストールすると <code>knife</code> というコマンドもインストールされる。
この <code>knife</code> コマンドを使ってクックブックを作る</p>

<p>今回は git をインストールするための git クックブックを作る</p>

<p>コマンドは以下のように指定する</p>

<pre><code class="bash">knife cookbooks create [クックブック名]
</code></pre>

<p>今回は出力先を指定する <code>-o</code> オプションを指定</p>

<pre><code class="bash">$ sudo knife cookbook create git -o /var/chef/cookbooks
</code></pre>

<p>このコマンドで git という名前のクックブックが作成され、 <code>/var/chef/cookbooks/git/recipes/default.rb</code> にレシピの雛形が作られる</p>

<h2>レシピの編集</h2>

<p>レシピの雛形に git をインストールするレシピを書く</p>

<pre><code class="bash">$ sudo vi /var/chef/cookbooks/git/recipes/default.rb
$ cat /var/chef/cookbooks/git/recipes/default.rb
#
# Cookbook Name:: git
# Recipe:: default
#
# Copyright 2015, YOUR_COMPANY_NAME
#
# All rights reserved - Do Not Redistribute
#

package "git" do
  action :install
end
</code></pre>

<h2>クックブックの実行</h2>

<p>作成したクックブックを実行する</p>

<pre><code class="bash">$ sudo chef-solo -o git
...
Compiling Cookbooks...
Converging 1 resources
Recipe: git::default
  * yum_package[git] action install
    - install version 1.7.1-3.el6_4.1 of package git

Running handlers:
Running handlers complete
Chef Client finished, 1/1 resources updated in 38 seconds
</code></pre>

<p>git がインストールされたか確認</p>

<pre><code class="bash">$ git --version
git version 1.7.1
</code></pre>

<h2>Chef の特徴</h2>

<h3>OS の違いを吸収してくれる</h3>

<p>上記 git の例ではこちらで指定していないにも関わらず、実行した環境が CentOS であることを解釈して yum パッケージでインストールが行われた</p>

<p>実行された環境の OS 毎の違いを吸収してくれる</p>

<h3>冪等性が担保されている</h3>

<p>先ほどのクックブックをもう一度実行してみる</p>

<pre><code class="bash">$ sudo chef-solo -o git
...
Chef Client finished, 0/1 resources updated in 07 seconds
</code></pre>

<p>今回は何もせずに正常に終了したことが分かる</p>

<p>Chef ではクックブックを何度実行しても、クックブックに規定された状態になる冪等性が担保されている</p>

<h2>参照</h2>

<ul>
<li><a href="http://www.amazon.co.jp/gp/product/477416500X/ref=as_li_tf_tl?ie=UTF8&amp;camp=247&amp;creative=1211&amp;creativeASIN=477416500X&amp;linkCode=as2&amp;tag=sojiro14-22">Chef 実践入門</a></li>
</ul>

]]></content>
  </entry>
  
</feed>
